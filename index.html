<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bridge - Connect. Collaborate. Close.</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        :root {
            --bg-primary: #FAFAFA;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F5F5F5;
            --bg-dark: #000000;
            --text-primary: #000000;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --accent-gold: #C9A961;
            --accent-sage: #E8F3E8;
            --accent-coral: #FFE8E8;
            --accent-blue: #E8F0FE;
            --border-light: #EEEEEE;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.5;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            z-index: 1000;
            border-bottom: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            height: 56px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .logo {
            width: 36px;
            height: 36px;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            font-family: 'Playfair Display', serif;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--accent-gold);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-light);
            z-index: 1000;
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.04);
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            padding: 0.5rem 0 1.5rem;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            text-decoration: none;
            color: var(--text-tertiary);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .nav-item:hover {
            color: var(--text-secondary);
        }

        .nav-item.active {
            color: var(--text-primary);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -0.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 2px;
            background: var(--bg-dark);
            border-radius: 2px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { width: 0; }
            to { width: 24px; }
        }

        /* Main Content */
        .main-content {
            padding-top: 56px;
            padding-bottom: 80px;
            min-height: 100vh;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Search */
        .search-wrapper {
            padding: 1rem;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-gold);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.1);
        }

        /* Filter Pills */
        .filter-section {
            padding: 1rem;
            background: var(--bg-secondary);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .filter-section::-webkit-scrollbar {
            display: none;
        }

        .filter-pills {
            display: flex;
            gap: 0.5rem;
            min-width: max-content;
        }

        .filter-pill {
            padding: 0.5rem 1.25rem;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
            border-radius: var(--radius-xl);
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-pill:hover {
            background: var(--bg-dark);
            color: white;
            transform: translateY(-1px);
        }

        .filter-pill.active {
            background: var(--bg-dark);
            color: white;
        }

        /* Property Cards */
        .properties-container {
            padding: 1rem;
        }

        .property-card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            border: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
        }

        .property-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .property-card:active {
            transform: scale(0.98);
        }

        .property-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.25rem 0.75rem;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: var(--radius-xl);
            font-size: 0.75rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .property-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--bg-tertiary);
            transition: var(--transition);
        }

        .property-card:hover .property-image {
            transform: scale(1.05);
        }

        .property-content {
            padding: 1.25rem;
        }

        .property-price {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .property-location {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: 0.75rem;
        }

        .property-specs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .commission-badge {
            background: var(--accent-gold);
            color: var(--bg-dark);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-xl);
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-block;
        }

        /* Forms */
        .form-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            animation: fadeIn 0.3s ease;
        }

        .form-field {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            font-size: 0.9375rem;
            font-family: inherit;
            transition: var(--transition);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
            background: var(--bg-secondary);
            box-shadow: 0 0 0 3px rgba(201, 169, 97, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Progress Steps */
        .progress-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding: 0 1rem;
            position: relative;
        }

        .progress-line {
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--border-light);
            z-index: 0;
        }

        .progress-line-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--accent-gold);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-step {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-xl);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-tertiary);
            transition: var(--transition);
            position: relative;
            z-index: 1;
            cursor: pointer;
        }

        .progress-step.active {
            background: var(--bg-dark);
            color: white;
        }

        .progress-step.completed {
            background: var(--accent-sage);
            color: var(--text-primary);
        }

        .progress-step:hover {
            transform: translateY(-2px);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--bg-dark);
            color: white;
        }

        .btn-primary:hover {
            background: #1a1a1a;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--border-light);
        }

        .btn-gold {
            background: var(--accent-gold);
            color: var(--bg-dark);
        }

        .btn-gold:hover {
            background: #b89651;
            transform: translateY(-1px);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            padding: 1rem;
            overflow-y: auto;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            margin: 3rem auto 2rem;
            max-width: 480px;
            animation: slideUp 0.3s ease;
            padding: 1.5rem;
            position: relative;
        }

        @keyframes slideUp {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.25rem;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-dark);
            color: white;
            transform: rotate(90deg);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-light);
            border-top-color: var(--bg-dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success Message */
        .success-message {
            background: var(--accent-sage);
            padding: 1rem;
            border-radius: var(--radius-md);
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 500;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Login */
        .login-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        /* Developer Section */
        .developer-hero {
            background: var(--bg-dark);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .developer-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 255, 255, 0.05) 10px,
                rgba(255, 255, 255, 0.05) 20px
            );
            animation: slide 20s linear infinite;
        }

        @keyframes slide {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .developer-hero-content {
            position: relative;
            z-index: 1;
        }

        .developer-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .developer-stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-gold);
        }

        .stat-label {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* Media Grid */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .media-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            color: inherit;
            border: 1px solid transparent;
        }

        .media-item:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .media-item:active {
            transform: scale(0.95);
        }

        .media-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .media-name {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            z-index: 3000;
            display: none;
            animation: toastIn 0.3s ease;
        }

        @keyframes toastIn {
            from { transform: translate(-50%, 100px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        /* Checkbox and Radio Styling */
        input[type="checkbox"],
        input[type="radio"] {
            width: 1.2rem;
            height: 1.2rem;
            cursor: pointer;
            margin-right: 0.5rem;
            accent-color: var(--accent-gold);
        }

        .checkbox-group,
        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .checkbox-label,
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            padding: 0.5rem;
            border-radius: var(--radius-md);
        }

        .checkbox-label:hover,
        .radio-label:hover {
            background: var(--bg-tertiary);
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
            color: var(--text-secondary);
            cursor: help;
            font-size: 0.875rem;
            margin-left: 0.25rem;
        }

        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--bg-dark);
            color: white;
            text-align: center;
            border-radius: var(--radius-md);
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Pricing Toggle */
        .pricing-toggle {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius-xl);
            padding: 0.25rem;
            margin-bottom: 1.5rem;
        }

        .pricing-toggle-option {
            flex: 1;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-xl);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .pricing-toggle-option.active {
            background: var(--bg-dark);
            color: white;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Grid responsiveness */
        @media (max-width: 640px) {
            .progress-step {
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
            }
        }

        @media (min-width: 768px) {
            .main-content {
                max-width: 768px;
                margin: 0 auto;
            }
            
            .properties-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .property-card {
                margin-bottom: 0;
            }
            
            .media-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-container" onclick="showPage('home')">
                <div class="logo">
                    <svg viewBox="0 0 36 36" fill="none">
                        <rect x="4" y="8" width="6" height="20" rx="1" fill="#000000"/>
                        <rect x="26" y="8" width="6" height="20" rx="1" fill="#000000"/>
                        <path d="M4 18 Q18 12 32 18" stroke="#C9A961" stroke-width="3" fill="none"/>
                        <path d="M7 8 L18 18 L29 8" stroke="#000000" stroke-width="1.5" fill="none"/>
                    </svg>
                </div>
                <span class="logo-text">Bridge</span>
            </div>
            <div id="userInfo" class="user-info" style="display: none;">
                <div id="userAvatar" class="user-avatar" onclick="showPage('profile')"></div>
                <span id="userName" style="font-size: 0.875rem;"></span>
            </div>
        </div>
    </header>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <div class="nav-item active" onclick="showPage('home')">
                <span>üè†</span>
                <span style="font-size: 0.75rem;">Home</span>
            </div>
            <div class="nav-item" onclick="showPage('developers')">
                <span>üè¢</span>
                <span style="font-size: 0.75rem;">Developers</span>
            </div>
            <div class="nav-item" onclick="showPage('add')">
                <span>‚ûï</span>
                <span style="font-size: 0.75rem;">List</span>
            </div>
            <div class="nav-item" onclick="showPage('saved')">
                <span>üíæ</span>
                <span style="font-size: 0.75rem;">Saved</span>
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <span>üë§</span>
                <span style="font-size: 0.75rem;">Profile</span>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Login Page -->
        <div id="loginPage" class="page">
            <div class="login-container">
                <div class="login-header">
                    <h1 class="login-title">Welcome to Bridge</h1>
                    <p style="color: var(--text-secondary);">Connect. Collaborate. Close.</p>
                </div>
                
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-section">
                        <div class="form-field">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="loginEmail" required>
                        </div>
                        <div class="form-field">
                            <label class="form-label">Access Code</label>
                            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your access code" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Sign In</button>
                    </div>
                </form>
                
                <p style="text-align: center; margin-top: 1rem; font-size: 0.875rem; color: var(--text-secondary);">
                    Demo: demo@bridge.co.ke / demo123
                </p>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage" class="page" style="display: none;">
            <div class="search-wrapper">
                <input type="text" class="search-input" placeholder="Search by area..." onkeyup="searchProperties(event)">
            </div>
            
            <div class="filter-section">
                <div class="filter-pills" id="areaFilters">
                    <div class="filter-pill active" onclick="filterByArea('All')">All Areas</div>
                </div>
            </div>
            
            <div class="properties-container">
                <div id="propertyList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading properties...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Developers Page -->
        <div id="developersPage" class="page" style="display: none;">
            <div class="developer-hero">
                <div class="developer-hero-content">
                    <h1 style="font-size: 1.875rem; margin-bottom: 0.5rem;">Developer Projects</h1>
                    <p>Direct from developers ‚Ä¢ Full documentation</p>
                    <div class="developer-stats">
                        <div class="developer-stat">
                            <div class="stat-value" id="totalProjects">0</div>
                            <div class="stat-label">Active Projects</div>
                        </div>
                        <div class="developer-stat">
                            <div class="stat-value">3-5%</div>
                            <div class="stat-label">Commission</div>
                        </div>
                        <div class="developer-stat">
                            <div class="stat-value" id="totalUnits">0</div>
                            <div class="stat-label">Units Available</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="properties-container">
                <div id="developerList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Add Listing Page -->
        <div id="addPage" class="page" style="display: none;">
            <div style="padding: 1.5rem; max-width: 800px; margin: 0 auto;">
                <h2 style="text-align: center; margin-bottom: 2rem; font-family: 'Playfair Display', serif;">List Your Property</h2>
                
                <div id="listingSuccess" class="success-message" style="display: none;">
                    ‚úì Property submitted successfully! We'll review and activate it within 24 hours.
                </div>

                <!-- Progress Indicator -->
                <div class="progress-container">
                    <div class="progress-line">
                        <div class="progress-line-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-step active" id="step1" onclick="goToStep(1)">
                        <span class="step-number">1</span> Basic
                    </div>
                    <div class="progress-step" id="step2" onclick="goToStep(2)">
                        <span class="step-number">2</span> Details
                    </div>
                    <div class="progress-step" id="step3" onclick="goToStep(3)">
                        <span class="step-number">3</span> Features
                    </div>
                    <div class="progress-step" id="step4" onclick="goToStep(4)">
                        <span class="step-number">4</span> Media
                    </div>
                    <div class="progress-step" id="step5" onclick="goToStep(5)">
                        <span class="step-number">5</span> Pricing
                    </div>
                </div>
                
                <form id="addListingForm" onsubmit="submitListing(event)">
                    <!-- Step 1: Basic Information -->
                    <div class="form-section" id="section1">
                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem;">
                            Basic Information
                        </h3>
                        
                        <div class="form-field">
                            <label class="form-label">
                                Property Type <span style="color: red;">*</span>
                                <span class="tooltip">‚ÑπÔ∏è
                                    <span class="tooltip-text">Select the type that best describes your property</span>
                                </span>
                            </label>
                            <select class="form-select" name="PropertyType" required onchange="handlePropertyTypeChange(this.value)">
                                <option value="">Select type</option>
                                <optgroup label="Residential">
                                    <option value="Apartment">Apartment</option>
                                    <option value="House">House</option>
                                    <option value="Townhouse">Townhouse</option>
                                    <option value="Villa">Villa</option>
                                    <option value="Studio">Studio</option>
                                    <option value="Penthouse">Penthouse</option>
                                    <option value="Bungalow">Bungalow</option>
                                    <option value="Maisonette">Maisonette</option>
                                </optgroup>
                                <optgroup label="Land">
                                    <option value="Land">Residential Land</option>
                                    <option value="Commercial Land">Commercial Land</option>
                                    <option value="Agricultural Land">Agricultural Land</option>
                                </optgroup>
                                <optgroup label="Commercial">
                                    <option value="Office">Office Space</option>
                                    <option value="Retail">Retail Space</option>
                                    <option value="Warehouse">Warehouse</option>
                                    <option value="Industrial">Industrial Property</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Property Title <span style="color: red;">*</span></label>
                            <input type="text" class="form-input" name="Title" placeholder="e.g., Modern 3BR Apartment with DSQ" required maxlength="100">
                            <small style="color: var(--text-tertiary);">Make it catchy and descriptive (max 100 characters)</small>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">General Area (Public) <span style="color: red;">*</span></label>
                            <select class="form-select" name="Area" required>
                                <option value="">Select area</option>
                                <optgroup label="Nairobi West">
                                    <option value="Westlands">Westlands</option>
                                    <option value="Parklands">Parklands</option>
                                    <option value="Spring Valley">Spring Valley</option>
                                    <option value="Loresho">Loresho</option>
                                    <option value="Riverside">Riverside</option>
                                </optgroup>
                                <optgroup label="Nairobi North">
                                    <option value="Runda">Runda</option>
                                    <option value="Muthaiga">Muthaiga</option>
                                    <option value="Gigiri">Gigiri</option>
                                    <option value="Ridgeways">Ridgeways</option>
                                    <option value="Garden Estate">Garden Estate</option>
                                </optgroup>
                                <optgroup label="Nairobi South">
                                    <option value="Karen">Karen</option>
                                    <option value="Langata">Langata</option>
                                    <option value="South B">South B</option>
                                    <option value="South C">South C</option>
                                    <option value="Nairobi West">Nairobi West</option>
                                </optgroup>
                                <optgroup label="Nairobi East">
                                    <option value="Kileleshwa">Kileleshwa</option>
                                    <option value="Kilimani">Kilimani</option>
                                    <option value="Lavington">Lavington</option>
                                    <option value="Hurlingham">Hurlingham</option>
                                    <option value="Upperhill">Upperhill</option>
                                </optgroup>
                                <optgroup label="Other Areas">
                                    <option value="Syokimau">Syokimau</option>
                                    <option value="Rongai">Rongai</option>
                                    <option value="Kitengela">Kitengela</option>
                                    <option value="Ruiru">Ruiru</option>
                                    <option value="Thika Road">Thika Road</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Sub-Area / Estate</label>
                            <input type="text" class="form-input" name="SubArea" placeholder="e.g., Kyuna Estate, Peponi Road">
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">
                                Exact Address <span style="color: red;">*</span>
                                <span class="tooltip">‚ÑπÔ∏è
                                    <span class="tooltip-text">This will only be shared with verified agents after mutual interest</span>
                                </span>
                            </label>
                            <textarea class="form-textarea" name="FullAddress" rows="2" placeholder="Full address including road name, house number, nearest landmark" required></textarea>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Google Maps Link</label>
                            <input type="url" class="form-input" name="MapsLink" placeholder="https://maps.google.com/...">
                        </div>
                    </div>

                    <!-- Step 2: Property Details -->
                    <div class="form-section" id="section2" style="display: none;">
                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem;">
                            Property Details
                        </h3>
                        
                        <!-- Residential Properties -->
                        <div id="residentialDetails">
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-field">
                                    <label class="form-label">Bedrooms <span style="color: red;">*</span></label>
                                    <select class="form-select" name="Bedrooms">
                                        <option value="">Select</option>
                                        <option value="0">Studio/Bedsitter</option>
                                        <option value="1">1 Bedroom</option>
                                        <option value="2">2 Bedrooms</option>
                                        <option value="3">3 Bedrooms</option>
                                        <option value="4">4 Bedrooms</option>
                                        <option value="5">5 Bedrooms</option>
                                        <option value="6">6+ Bedrooms</option>
                                    </select>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Bathrooms <span style="color: red;">*</span></label>
                                    <select class="form-select" name="Bathrooms">
                                        <option value="">Select</option>
                                        <option value="1">1 Bathroom</option>
                                        <option value="1.5">1.5 Bathrooms</option>
                                        <option value="2">2 Bathrooms</option>
                                        <option value="2.5">2.5 Bathrooms</option>
                                        <option value="3">3 Bathrooms</option>
                                        <option value="3.5">3.5 Bathrooms</option>
                                        <option value="4">4+ Bathrooms</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-field">
                                    <label class="form-label">Floor Size (sqm)</label>
                                    <input type="number" class="form-input" name="FloorSize" placeholder="e.g., 145">
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Property Condition <span style="color: red;">*</span></label>
                                    <select class="form-select" name="Condition">
                                        <option value="">Select condition</option>
                                        <option value="Brand New">Brand New</option>
                                        <option value="Excellent">Excellent - Like New</option>
                                        <option value="Very Good">Very Good - Well Maintained</option>
                                        <option value="Good">Good - Minor Touch-ups Needed</option>
                                        <option value="Fair">Fair - Some Renovation Needed</option>
                                        <option value="Needs Work">Needs Major Renovation</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Land Properties -->
                        <div id="landDetails" style="display: none;">
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-field">
                                    <label class="form-label">Land Size <span style="color: red;">*</span></label>
                                    <input type="text" class="form-input" name="LandSize" placeholder="e.g., 0.25 acres, 50x100">
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Zoning <span style="color: red;">*</span></label>
                                    <select class="form-select" name="Zoning">
                                        <option value="">Select zoning</option>
                                        <option value="Residential">Residential</option>
                                        <option value="Commercial">Commercial</option>
                                        <option value="Agricultural">Agricultural</option>
                                        <option value="Mixed Use">Mixed Use</option>
                                        <option value="Industrial">Industrial</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-field">
                                    <label class="form-label">Title Deed Available?</label>
                                    <select class="form-select" name="TitleDeed">
                                        <option value="Yes">Yes - Ready</option>
                                        <option value="Processing">In Processing</option>
                                        <option value="No">No</option>
                                    </select>
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Soil Type</label>
                                    <select class="form-select" name="SoilType">
                                        <option value="">Select soil type</option>
                                        <option value="Red Soil">Red Soil</option>
                                        <option value="Black Cotton">Black Cotton</option>
                                        <option value="Loam">Loam</option>
                                        <option value="Sandy">Sandy</option>
                                        <option value="Clay">Clay</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Commercial Properties -->
                        <div id="commercialDetails" style="display: none;">
                            <div class="form-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                <div class="form-field">
                                    <label class="form-label">Floor Space (sqm) <span style="color: red;">*</span></label>
                                    <input type="number" class="form-input" name="FloorSpace" placeholder="e.g., 500">
                                </div>
                                
                                <div class="form-field">
                                    <label class="form-label">Number of Floors</label>
                                    <input type="number" class="form-input" name="Floors" placeholder="e.g., 3">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Common fields for all -->
                        <div class="form-field">
                            <label class="form-label">Year Built</label>
                            <input type="number" class="form-input" name="YearBuilt" placeholder="e.g., 2020" min="1950" max="2024">
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Furnishing Status</label>
                            <select class="form-select" name="Furnishing">
                                <option value="Unfurnished">Unfurnished</option>
                                <option value="Semi-Furnished">Semi-Furnished</option>
                                <option value="Fully Furnished">Fully Furnished</option>
                            </select>
                        </div>
                    </div>

                    <!-- Step 3: Features & Amenities -->
                    <div class="form-section" id="section3" style="display: none;">
                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem;">
                            Features & Amenities
                        </h3>
                        
                        <!-- Residential Features -->
                        <div id="residentialFeatures">
                            <div class="form-field">
                                <label class="form-label">Interior Features</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Master Ensuite"> Master Ensuite
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Walk-in Closet"> Walk-in Closet
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Kitchen Island"> Kitchen Island
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Pantry"> Pantry
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Laundry Room"> Laundry Room
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Study Room"> Study/Home Office
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Fireplace"> Fireplace
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Air Conditioning"> Air Conditioning
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">External Features</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Garden"> Garden
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Swimming Pool"> Swimming Pool
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Gym"> Gym
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Playground"> Children's Playground
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Rooftop Terrace"> Rooftop Terrace
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Clubhouse"> Clubhouse
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">Parking</label>
                                <select class="form-select" name="Parking">
                                    <option value="None">No Parking</option>
                                    <option value="1">1 Parking Space</option>
                                    <option value="2">2 Parking Spaces</option>
                                    <option value="3">3 Parking Spaces</option>
                                    <option value="4+">4+ Parking Spaces</option>
                                    <option value="Ample">Ample Parking</option>
                                </select>
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">DSQ (Domestic Staff Quarters)</label>
                                <select class="form-select" name="DSQ">
                                    <option value="No">No DSQ</option>
                                    <option value="Yes - Attached">Yes - Attached</option>
                                    <option value="Yes - Detached">Yes - Detached</option>
                                    <option value="Yes - Multiple">Yes - Multiple DSQs</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Land Features -->
                        <div id="landFeatures" style="display: none;">
                            <div class="form-field">
                                <label class="form-label">Land Features</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Fenced"> Fenced
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Gate"> Gated
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Corner Plot"> Corner Plot
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Main Road Frontage"> Main Road Frontage
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Cul-de-sac"> Cul-de-sac
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Near Amenities"> Near Amenities
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Commercial Features -->
                        <div id="commercialFeatures" style="display: none;">
                            <div class="form-field">
                                <label class="form-label">Commercial Features</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Loading Bay"> Loading Bay
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Warehouse Space"> Warehouse Space
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Office Partitions"> Office Partitions
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Reception Area"> Reception Area
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Conference Room"> Conference Room
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" name="features" value="Kitchenette"> Kitchenette
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Features (common) -->
                        <div class="form-field">
                            <label class="form-label">Security Features</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="Gated Community"> Gated Community
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="24/7 Security"> 24/7 Security
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="CCTV"> CCTV Surveillance
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="Electric Fence"> Electric Fence
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="Intercom"> Intercom System
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="features" value="Alarm System"> Alarm System
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Media & Description -->
                    <div class="form-section" id="section4" style="display: none;">
                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem;">
                            Media & Description
                        </h3>
                        
                        <div class="form-field">
                            <label class="form-label">
                                Property Description <span style="color: red;">*</span>
                                <span class="tooltip">‚ÑπÔ∏è
                                    <span class="tooltip-text">Be descriptive! Mention unique features, renovations, views, etc.</span>
                                </span>
                            </label>
                            <textarea class="form-textarea" name="Description" rows="6" placeholder="Provide a detailed description of the property including unique selling points..." required onkeyup="updateDescriptionCount(this)"></textarea>
                            <small style="color: var(--text-tertiary);"><span id="descriptionCount">0</span>/500 characters minimum</small>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Nearby Amenities</label>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Shopping Mall"> Shopping Mall
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Hospital"> Hospital
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="School"> School
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Public Transport"> Public Transport
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Gym"> Gym
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Restaurant"> Restaurants
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Bank"> Bank/ATM
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="nearbyAmenities" value="Church"> Place of Worship
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Virtual Tour Link (Optional)</label>
                            <input type="url" class="form-input" name="VirtualTour" placeholder="YouTube or Vimeo link">
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Photo Upload Instructions</label>
                            <div style="background: var(--accent-sage); padding: 1rem; border-radius: var(--radius-md);">
                                <p style="font-size: 0.875rem; margin-bottom: 0.5rem;">üì∏ For best results, please upload:</p>
                                <ul style="font-size: 0.875rem; margin-left: 1.5rem;">
                                    <li>Minimum 5 high-quality photos</li>
                                    <li>Include: Exterior, Living room, Kitchen, Bedrooms, Bathrooms</li>
                                    <li>Well-lit, landscape orientation preferred</li>
                                    <li>Upload directly to Airtable after submission</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Step 5: Pricing & Commission -->
                    <div class="form-section" id="section5" style="display: none;">
                        <h3 style="font-size: 1rem; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 1rem;">
                            Pricing & Commission
                        </h3>
                        
                        <div class="form-field">
                            <label class="form-label">Listing Type <span style="color: red;">*</span></label>
                            <div class="pricing-toggle">
                                <div class="pricing-toggle-option active" onclick="togglePricingType('sale')" id="saleToggle">For Sale</div>
                                <div class="pricing-toggle-option" onclick="togglePricingType('rent')" id="rentToggle">For Rent</div>
                            </div>
                        </div>
                        
                        <!-- Sale Pricing -->
                        <div id="salePricing">
                            <div class="form-field">
                                <label class="form-label">Sale Price (KES) <span style="color: red;">*</span></label>
                                <input type="number" class="form-input" name="Price" placeholder="e.g., 15000000" min="0">
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">Price Negotiable?</label>
                                <select class="form-select" name="Negotiable">
                                    <option value="Yes">Yes - Open to Offers</option>
                                    <option value="Slight">Slightly Negotiable</option>
                                    <option value="No">No - Fixed Price</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Rental Pricing -->
                        <div id="rentalPricing" style="display: none;">
                            <div class="form-field">
                                <label class="form-label">Monthly Rent (KES) <span style="color: red;">*</span></label>
                                <input type="number" class="form-input" name="MonthlyRent" placeholder="e.g., 150000" min="0">
                            </div>
                            
                            <div class="form-field">
                                <label class="form-label">Service Charge (Optional)</label>
                                <input type="number" class="form-input" name="ServiceCharge" placeholder="Monthly service charge amount" min="0">
                            </div>
                        </div>
                        
                        <!-- Common Pricing Fields -->
                        <div class="form-field">
                            <label class="form-label">Total Commission (%) <span style="color: red;">*</span></label>
                            <select class="form-select" name="TotalCommission" required onchange="calculateCommission()">
                                <option value="">Select commission</option>
                                <option value="3">3%</option>
                                <option value="3.5">3.5%</option>
                                <option value="4">4%</option>
                                <option value="5">5%</option>
                                <option value="6">6%</option>
                            </select>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Commission Split <span style="color: red;">*</span></label>
                            <select class="form-select" name="CommissionSplit" required onchange="calculateCommission()">
                                <option value="">Select split</option>
                                <option value="50-50">50/50 - Equal split</option>
                                <option value="60-40">60/40 - Listing agent favor</option>
                                <option value="40-60">40/60 - Selling agent favor</option>
                                <option value="70-30">70/30 - Listing agent favor</option>
                                <option value="30-70">30/70 - Selling agent favor</option>
                            </select>
                        </div>
                        
                        <div id="commissionPreview" style="display: none; background: var(--accent-gold); padding: 1rem; border-radius: var(--radius-md); margin-top: 1rem;">
                            <!-- Commission preview will be shown here -->
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Special Terms or Conditions</label>
                            <textarea class="form-textarea" name="SpecialTerms" rows="2" placeholder="e.g., Cash buyers only, Tenant must take over existing furniture, etc."></textarea>
                        </div>
                        
                        <div class="form-field">
                            <label class="form-label">Availability Date</label>
                            <input type="date" class="form-input" name="AvailabilityDate">
                        </div>
                        
                        <div class="form-field" style="margin-top: 2rem;">
                            <label class="checkbox-label">
                                <input type="checkbox" name="AgreeToTerms" required> I confirm that I have the legal authority to list this property and all information provided is accurate
                            </label>
                        </div>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button type="button" class="btn btn-secondary" onclick="previousStep()" id="prevBtn" style="display: none;">Previous</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()" id="nextBtn">Next</button>
                        <button type="submit" class="btn btn-gold" id="submitBtn" style="display: none;">Submit Listing</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Saved Page -->
        <div id="savedPage" class="page" style="display: none;">
            <div style="padding: 1rem;">
                <h2 style="font-size: 1.125rem; margin-bottom: 1rem;">Saved Properties</h2>
                <div id="savedList">
                    <p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No saved properties yet</p>
                </div>
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profilePage" class="page" style="display: none;">
            <div style="padding: 1.5rem; text-align: center;">
                <h2 style="margin-bottom: 1rem;">Your Profile</h2>
                <div id="profileInfo" style="margin-bottom: 2rem;"></div>
                <button class="btn btn-primary" onclick="logout()">Sign Out</button>
            </div>
        </div>
    </main>

    <!-- Property Modal -->
    <div id="propertyModal" class="modal" onclick="closeModalOnOutside(event)">
        <div class="modal-content" id="modalContent">
            <!-- Content will be loaded here -->
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Configuration
        const AIRTABLE_API_KEY = 'patnr2ahdHJSQvYM0.1f71a8a57d95d0ec22b0d6f5a38ce8b9a26b2c375c38b86ed696bd35444b877c';
        const AIRTABLE_BASE_ID = 'appMw7aGUXAcajzdS';
        
        // Table names from your Airtable
        const TABLES = {
            AGENTS: 'Agents',
            PROPERTIES: 'Properties',
            DEVELOPER_PROJECTS: 'DeveloperProjects',
            PROJECT_MEDIA: 'ProjectMedia',
            CONNECTIONS: 'Connections',
            PROPERTY_VIEWS: 'PropertyViews'
        };
        
        // Simple authentication
        const VALID_AGENTS = {
            'demo@bridge.co.ke': 'demo123',
            'agent1@bridge.co.ke': 'bridge2024',
            'agent2@bridge.co.ke': 'bridge2024',
            'sarah@bridge.co.ke': 'sarah123',
            'james@bridge.co.ke': 'james123'
        };

        // Kenyan areas
        const KENYA_AREAS = [
            'Westlands', 'Kilimani', 'Karen', 'Kileleshwa', 'Lavington',
            'Runda', 'Muthaiga', 'Parklands', 'South B', 'South C',
            'Langata', 'Ridgeways', 'Gigiri', 'Spring Valley', 'Loresho'
        ];

        // State
        let currentUser = null;
        let properties = [];
        let developerProjects = [];
        let currentFilter = 'All';
        let savedProperties = JSON.parse(localStorage.getItem('bridgeSaved') || '[]');
        let currentStep = 1;
        let listingType = 'sale';

        // Initialize
        function init() {
            const user = localStorage.getItem('bridgeUser');
            if (user) {
                currentUser = JSON.parse(user);
                showUserInfo();
                showPage('home');
                loadData();
            } else {
                showPage('login');
            }
            
            // Populate area filters
            const filterContainer = document.getElementById('areaFilters');
            KENYA_AREAS.forEach(area => {
                const pill = document.createElement('div');
                pill.className = 'filter-pill';
                pill.textContent = area;
                pill.onclick = () => filterByArea(area);
                filterContainer.appendChild(pill);
            });
        }

        // Show user info
        function showUserInfo() {
            document.getElementById('userInfo').style.display = 'flex';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }

        // Handle login
        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (VALID_AGENTS[email] === password) {
                currentUser = { 
                    email, 
                    name: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1)
                };
                localStorage.setItem('bridgeUser', JSON.stringify(currentUser));
                showUserInfo();
                showPage('home');
                loadData();
                showToast('Welcome to Bridge!');
            } else {
                showToast('Invalid credentials. Please try again.');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('bridgeUser');
            currentUser = null;
            window.location.reload();
        }

        // Load all data
        async function loadData() {
            await Promise.all([
                loadProperties(),
                loadDeveloperProjects()
            ]);
        }

        // Load properties from Airtable
        async function loadProperties() {
            try {
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.PROPERTIES}?filterByFormula={Status}='Active'&sort[0][field]=CreatedDate&sort[0][direction]=desc`,
                    {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                properties = data.records.map(record => ({
                    id: record.id,
                    ...record.fields
                }));

                renderProperties();
            } catch (error) {
                console.error('Error loading properties:', error);
                document.getElementById('propertyList').innerHTML = 
                    '<p style="text-align: center; color: var(--text-secondary);">Failed to load properties. Please refresh.</p>';
            }
        }

        // Load developer projects
        async function loadDeveloperProjects() {
            try {
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.DEVELOPER_PROJECTS}?filterByFormula={Status}='Active'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                        }
                    }
                );

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                developerProjects = data.records.map(record => ({
                    id: record.id,
                    ...record.fields
                }));

                // Update stats
                document.getElementById('totalProjects').textContent = developerProjects.length;
                const totalUnits = developerProjects.reduce((sum, p) => sum + (p.UnitsAvailable || 0), 0);
                document.getElementById('totalUnits').textContent = totalUnits;

                renderDeveloperProjects();
            } catch (error) {
                console.error('Error loading developer projects:', error);
            }
        }

        // Render properties
        function renderProperties(propertiesToRender = properties) {
            const container = document.getElementById('propertyList');
            
            if (propertiesToRender.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No properties found</p>';
                return;
            }

            container.innerHTML = propertiesToRender.map(property => {
                const imageUrl = property.Images && property.Images[0] 
                    ? property.Images[0].url 
                    : 'https://via.placeholder.com/400x200?text=No+Image';

                const listingTypeText = property.ListingType || 'For Sale';
                const priceText = listingTypeText === 'For Rent' 
                    ? `KES ${formatPrice(property.Price || 0)}/mo` 
                    : `KES ${formatPrice(property.Price || 0)}`;

                return `
                    <div class="property-card" onclick="showPropertyDetails('${property.id}')">
                        <div class="property-badge">${listingTypeText}</div>
                        <img src="${imageUrl}" alt="Property" class="property-image">
                        <div class="property-content">
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">${property.Title || 'Untitled Property'}</h3>
                            <div class="property-price">${priceText}</div>
                            <div class="property-location">üìç ${property.Area || 'Area not specified'}</div>
                            <div class="property-specs">
                                <span>üõè ${property.Bedrooms || 0} beds</span>
                                <span>üöø ${property.Bathrooms || 0} baths</span>
                                <span>üìê ${property.FloorSize ? property.FloorSize + ' sqm' : property.Size || 'N/A'}</span>
                            </div>
                            <div class="commission-badge">
                                ${property.TotalCommission || 3}% ‚Ä¢ ${property.CommissionSplit || '50-50'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render developer projects
        function renderDeveloperProjects() {
            const container = document.getElementById('developerList');
            
            if (developerProjects.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No projects available</p>';
                return;
            }

            container.innerHTML = developerProjects.map(project => {
                const imageUrl = project.MainImage && project.MainImage[0] 
                    ? project.MainImage[0].url 
                    : 'https://via.placeholder.com/400x200?text=No+Image';

                return `
                    <div class="property-card" onclick="showDeveloperDetails('${project.id}')">
                        <img src="${imageUrl}" alt="${project.ProjectName}" class="property-image">
                        <div class="property-content">
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">${project.ProjectName || 'Unnamed Project'}</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">by ${project.Developer || 'Developer'}</p>
                            <div class="property-price">From KES ${formatPrice(project.PriceFrom || 0)}</div>
                            <div class="property-location">üìç ${project.Area || 'Location'}</div>
                            <div style="margin-top: 1rem;">
                                <span class="commission-badge">${project.Commission || 5}% Commission</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show property details
        function showPropertyDetails(propertyId) {
            const property = properties.find(p => p.id === propertyId);
            if (!property) return;

            const isSaved = savedProperties.includes(propertyId);

            // Log property view
            logPropertyView(propertyId);

            const features = property.Features ? property.Features.split(',').map(f => f.trim()) : [];
            const nearbyAmenities = property.NearbyAmenities ? property.NearbyAmenities.split(',').map(a => a.trim()) : [];

            document.getElementById('modalContent').innerHTML = `
                <div class="modal-header">
                    <h3>${property.Title || 'Property in ' + property.Area}</h3>
                    <button class="modal-close" onclick="closeModal()">√ó</button>
                </div>
                
                <div style="background: var(--accent-sage); padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                    <p style="font-size: 0.875rem;">Listed by: ${property.AgentName || 'Agent'} ‚Ä¢ ${property.Agency || 'Agency'}</p>
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <p><strong>Type:</strong> ${property.PropertyType || 'Not specified'}</p>
                    <p><strong>Configuration:</strong> ${property.Bedrooms || 0} Bed, ${property.Bathrooms || 0} Bath</p>
                    <p><strong>Size:</strong> ${property.FloorSize ? property.FloorSize + ' sqm' : property.Size || 'Not specified'}</p>
                    <p><strong>Condition:</strong> ${property.Condition || 'Not specified'}</p>
                    <p><strong>Year Built:</strong> ${property.YearBuilt || 'Not specified'}</p>
                    <p><strong>Furnishing:</strong> ${property.Furnishing || 'Not specified'}</p>
                    ${property.SubArea ? `<p><strong>Sub-Area:</strong> ${property.SubArea}</p>` : ''}
                    <p><strong>Price:</strong> KES ${formatPrice(property.Price || 0)} ${property.Negotiable ? '(' + property.Negotiable + ')' : ''}</p>
                    ${property.ServiceCharge ? `<p><strong>Service Charge:</strong> KES ${formatPrice(property.ServiceCharge)}/mo</p>` : ''}
                    ${property.Description ? `<p style="margin-top: 1rem;">${property.Description}</p>` : ''}
                </div>
                
                ${features.length > 0 ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 0.5rem;">Features & Amenities</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            ${features.map(feature => `
                                <span style="background: var(--accent-blue); padding: 0.25rem 0.75rem; border-radius: var(--radius-xl); font-size: 0.875rem;">
                                    ${feature}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                ${nearbyAmenities.length > 0 ? `
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 0.5rem;">Nearby Amenities</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            ${nearbyAmenities.map(amenity => `
                                <span style="background: var(--bg-tertiary); padding: 0.25rem 0.75rem; border-radius: var(--radius-xl); font-size: 0.875rem;">
                                    ${amenity}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div style="background: var(--bg-dark); color: white; padding: 1rem; border-radius: var(--radius-md); margin-bottom: 1rem;">
                    <h4 style="margin-bottom: 0.5rem;">Commission Structure</h4>
                    <p>Total: ${property.TotalCommission || 3}% ‚Ä¢ Split: ${property.CommissionSplit || '50-50'}</p>
                    <p style="margin-top: 0.5rem; font-size: 0.875rem;">
                        Your potential earnings: KES ${formatPrice(calculateCommission(property.Price, property.TotalCommission, property.CommissionSplit))}
                    </p>
                </div>
                
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="requestContact('${propertyId}')">
                        Request Contact
                    </button>
                    <button class="btn btn-gold" style="flex: 1;" onclick="toggleSave('${propertyId}')">
                        ${isSaved ? 'Unsave' : 'Save'}
                    </button>
                </div>
            `;

            document.getElementById('propertyModal').style.display = 'block';
        }

        // Show developer details
        function showDeveloperDetails(projectId) {
            const project = developerProjects.find(p => p.id === projectId);
            if (!project) return;

            // Load media files for this project
            loadProjectMedia(projectId).then(mediaFiles => {
                const mediaHtml = mediaFiles.length > 0 ? `
                    <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Downloadable Documents</h4>
                    <div class="media-grid">
                        ${mediaFiles.map(media => `
                            <a href="${media.FileUrl}" target="_blank" class="media-item">
                                <div class="media-icon">${getMediaIcon(media.Type)}</div>
                                <div class="media-name">${media.Name}</div>
                            </a>
                        `).join('')}
                    </div>
                ` : '';

                document.getElementById('modalContent').innerHTML = `
                    <div class="modal-header">
                        <h3>${project.ProjectName}</h3>
                        <button class="modal-close" onclick="closeModal()">√ó</button>
                    </div>
                    
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">by ${project.Developer}</p>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <p><strong>Location:</strong> ${project.Area}</p>
                        <p><strong>Price Range:</strong> KES ${formatPrice(project.PriceFrom || 0)} - ${formatPrice(project.PriceTo || 0)}</p>
                        <p><strong>Units Available:</strong> ${project.UnitsAvailable || 0} of ${project.TotalUnits || 0}</p>
                        <p><strong>Completion:</strong> ${project.CompletionDate || 'TBD'}</p>
                        <p><strong>Commission:</strong> ${project.Commission || 5}%</p>
                        ${project.PropertyTypes ? `<p><strong>Types:</strong> ${project.PropertyTypes}</p>` : ''}
                        ${project.Amenities ? `<p><strong>Amenities:</strong> ${project.Amenities}</p>` : ''}
                    </div>
                    
                    ${mediaHtml}
                    
                    <div style="background: var(--bg-dark); color: white; padding: 1rem; border-radius: var(--radius-md); margin: 1.5rem 0;">
                        <h4 style="margin-bottom: 0.5rem;">Contact Developer</h4>
                        <p style="font-size: 0.875rem;">${project.ContactName || 'Contact Person'}</p>
                        <p style="font-size: 0.875rem;">üìû ${project.ContactPhone || 'Not provided'}</p>
                        <p style="font-size: 0.875rem;">‚úâÔ∏è ${project.ContactEmail || 'Not provided'}</p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="closeModal()">Close</button>
                `;
            });

            document.getElementById('propertyModal').style.display = 'block';
        }

        // Load project media
        async function loadProjectMedia(projectId) {
            try {
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.PROJECT_MEDIA}?filterByFormula={ProjectId}='${projectId}'`,
                    {
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`
                        }
                    }
                );

                if (!response.ok) return [];

                const data = await response.json();
                return data.records.map(record => record.fields);
            } catch (error) {
                console.error('Error loading media:', error);
                return [];
            }
        }

        // Get media icon
        function getMediaIcon(type) {
            const icons = {
                'PDF': 'üìÑ',
                'Image': 'üñºÔ∏è',
                'Video': 'üé•',
                'Document': 'üìã'
            };
            return icons[type] || 'üìé';
        }

        // Multi-step form handling
        function goToStep(step) {
            if (step < currentStep || validateCurrentStep()) {
                currentStep = step;
                updateStepDisplay();
            }
        }

        function nextStep() {
            if (validateCurrentStep() && currentStep < 5) {
                currentStep++;
                updateStepDisplay();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function updateStepDisplay() {
            // Update sections
            for (let i = 1; i <= 5; i++) {
                document.getElementById(`section${i}`).style.display = i === currentStep ? 'block' : 'none';
                document.getElementById(`step${i}`).classList.toggle('active', i === currentStep);
                document.getElementById(`step${i}`).classList.toggle('completed', i < currentStep);
            }
            
            // Update progress bar
            const progress = ((currentStep - 1) / 4) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            // Update buttons
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < 5 ? 'block' : 'none';
            document.getElementById('submitBtn').style.display = currentStep === 5 ? 'block' : 'none';
            
            // Scroll to top of form
            window.scrollTo(0, 0);
        }

        function validateCurrentStep() {
            const currentSection = document.getElementById(`section${currentStep}`);
            const requiredFields = currentSection.querySelectorAll('[required]:not([type="checkbox"])');
            
            let isValid = true;
            requiredFields.forEach(field => {
                if (!field.value) {
                    field.style.borderColor = 'red';
                    isValid = false;
                } else {
                    field.style.borderColor = '';
                }
            });
            
            // Special validation for checkboxes
            if (currentStep === 5) {
                const agreeCheckbox = document.querySelector('[name="AgreeToTerms"]');
                if (!agreeCheckbox.checked) {
                    isValid = false;
                    showToast('Please agree to the terms');
                }
            }
            
            if (!isValid) {
                showToast('Please fill in all required fields');
            }
            
            return isValid;
        }

        function handlePropertyTypeChange(type) {
            // Show/hide relevant sections based on property type
            const residentialTypes = ['Apartment', 'House', 'Townhouse', 'Villa', 'Studio', 'Penthouse', 'Bungalow', 'Maisonette'];
            const landTypes = ['Land', 'Commercial Land', 'Agricultural Land'];
            const commercialTypes = ['Office', 'Retail', 'Warehouse', 'Industrial'];
            
            // Details section
            document.getElementById('residentialDetails').style.display = residentialTypes.includes(type) ? 'block' : 'none';
            document.getElementById('landDetails').style.display = landTypes.includes(type) ? 'block' : 'none';
            document.getElementById('commercialDetails').style.display = commercialTypes.includes(type) ? 'block' : 'none';
            
            // Features section
            document.getElementById('residentialFeatures').style.display = residentialTypes.includes(type) ? 'block' : 'none';
            document.getElementById('landFeatures').style.display = landTypes.includes(type) ? 'block' : 'none';
            document.getElementById('commercialFeatures').style.display = commercialTypes.includes(type) ? 'block' : 'none';
        }

        function updateDescriptionCount(textarea) {
            const count = textarea.value.length;
            document.getElementById('descriptionCount').textContent = count;
            
            if (count < 500) {
                document.getElementById('descriptionCount').style.color = 'var(--text-tertiary)';
            } else {
                document.getElementById('descriptionCount').style.color = 'var(--accent-sage)';
            }
        }

        function togglePricingType(type) {
            listingType = type;
            if (type === 'sale') {
                document.getElementById('saleToggle').classList.add('active');
                document.getElementById('rentToggle').classList.remove('active');
                document.getElementById('salePricing').style.display = 'block';
                document.getElementById('rentalPricing').style.display = 'none';
            } else {
                document.getElementById('rentToggle').classList.add('active');
                document.getElementById('saleToggle').classList.remove('active');
                document.getElementById('rentalPricing').style.display = 'block';
                document.getElementById('salePricing').style.display = 'none';
            }
        }

        function calculateCommission() {
            const priceField = listingType === 'sale' 
                ? document.querySelector('[name="Price"]').value 
                : document.querySelector('[name="MonthlyRent"]').value;
            const totalCommission = document.querySelector('[name="TotalCommission"]').value;
            const split = document.querySelector('[name="CommissionSplit"]').value;
            
            if (priceField && totalCommission && split) {
                const price = parseInt(priceField);
                const total = price * (totalCommission / 100);
                const [listing, selling] = split.split('-').map(Number);
                const listingAmount = total * (listing / 100);
                const sellingAmount = total * (selling / 100);
                
                document.getElementById('commissionPreview').style.display = 'block';
                document.getElementById('commissionPreview').innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 0.5rem;">Commission Breakdown</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span>Total Commission (${totalCommission}%):</span>
                        <span>KES ${formatPrice(total)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                        <span>Listing Agent (${listing}%):</span>
                        <span>KES ${formatPrice(listingAmount)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Selling Agent (${selling}%):</span>
                        <span>KES ${formatPrice(sellingAmount)}</span>
                    </div>
                `;
            }
        }

        // Submit listing
        async function submitListing(event) {
            event.preventDefault();
            
            if (!validateCurrentStep()) {
                return;
            }
            
            const formData = new FormData(event.target);
            
            // Collect features
            const features = Array.from(document.querySelectorAll('input[name="features"]:checked'))
                .map(cb => cb.value)
                .join(', ');
            
            // Collect nearby amenities
            const nearbyAmenities = Array.from(document.querySelectorAll('input[name="nearbyAmenities"]:checked'))
                .map(cb => cb.value)
                .join(', ');
            
            const listing = {
                // Basic Information
                PropertyType: formData.get('PropertyType'),
                Title: formData.get('Title'),
                Area: formData.get('Area'),
                SubArea: formData.get('SubArea'),
                FullAddress: formData.get('FullAddress'),
                MapsLink: formData.get('MapsLink'),
                
                // Property Details
                Bedrooms: parseInt(formData.get('Bedrooms') || 0),
                Bathrooms: parseFloat(formData.get('Bathrooms') || 0),
                FloorSize: formData.get('FloorSize'),
                LandSize: formData.get('LandSize'),
                FloorNumber: formData.get('FloorNumber'),
                TotalFloors: formData.get('TotalFloors'),
                YearBuilt: formData.get('YearBuilt'),
                Condition: formData.get('Condition'),
                Furnishing: formData.get('Furnishing'),
                Zoning: formData.get('Zoning'),
                TitleDeed: formData.get('TitleDeed'),
                SoilType: formData.get('SoilType'),
                FloorSpace: formData.get('FloorSpace'),
                Floors: formData.get('Floors'),
                
                // Features
                Features: features,
                Parking: formData.get('Parking'),
                DSQ: formData.get('DSQ'),
                
                // Description
                Description: formData.get('Description'),
                NearbyAmenities: nearbyAmenities,
                VirtualTour: formData.get('VirtualTour'),
                
                // Pricing
                ListingType: listingType === 'sale' ? 'For Sale' : 'For Rent',
                Price: parseInt(listingType === 'sale' ? formData.get('Price') : formData.get('MonthlyRent')),
                Negotiable: formData.get('Negotiable'),
                ServiceCharge: formData.get('ServiceCharge'),
                TotalCommission: parseFloat(formData.get('TotalCommission')),
                CommissionSplit: formData.get('CommissionSplit'),
                SpecialTerms: formData.get('SpecialTerms'),
                AvailabilityDate: formData.get('AvailabilityDate'),
                
                // Agent Info
                AgentName: currentUser.name,
                AgentEmail: currentUser.email,
                Agency: 'Independent', // Update if needed
                Status: 'Pending',
                CreatedDate: new Date().toISOString()
            };

            try {
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.PROPERTIES}`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ fields: listing })
                    }
                );

                if (response.ok) {
                    document.getElementById('listingSuccess').style.display = 'block';
                    event.target.reset();
                    showToast('Property submitted successfully! üéâ');
                    
                    // Reset to first step
                    currentStep = 1;
                    updateStepDisplay();
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                    
                    setTimeout(() => {
                        document.getElementById('listingSuccess').style.display = 'none';
                        showPage('home');
                        loadProperties(); // Reload properties
                    }, 3000);
                } else {
                    const error = await response.json();
                    console.error('Airtable error:', error);
                    showToast('Failed to submit listing. Please try again.');
                }
            } catch (error) {
                console.error('Error submitting listing:', error);
                showToast('Error submitting listing. Please check your connection.');
            }
        }

        // Request contact
        async function requestContact(propertyId) {
            const property = properties.find(p => p.id === propertyId);
            if (!property) return;

            try {
                // Create connection request
                const response = await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.CONNECTIONS}`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            fields: {
                                PropertyId: propertyId,
                                ListingAgentId: property.AgentId || property.AgentEmail,
                                RequestingAgentId: currentUser.email,
                                RequestingAgentName: currentUser.name,
                                Status: 'Pending',
                                RequestedDate: new Date().toISOString()
                            }
                        })
                    }
                );

                if (response.ok) {
                    showToast('Contact request sent! The agent will respond soon.');
                    closeModal();
                } else {
                    showToast('Failed to send request. Please try again.');
                }
            } catch (error) {
                console.error('Error sending request:', error);
                showToast('Error sending request.');
            }
        }

        // Log property view
        async function logPropertyView(propertyId) {
            try {
                await fetch(
                    `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${TABLES.PROPERTY_VIEWS}`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            fields: {
                                PropertyId: propertyId,
                                AgentId: currentUser.email,
                                ViewedAt: new Date().toISOString()
                            }
                        })
                    }
                );
            } catch (error) {
                console.error('Error logging view:', error);
            }
        }

        // Toggle save property
        function toggleSave(propertyId) {
            const index = savedProperties.indexOf(propertyId);
            if (index > -1) {
                savedProperties.splice(index, 1);
                showToast('Property removed from saved');
            } else {
                savedProperties.push(propertyId);
                showToast('Property saved');
            }
            localStorage.setItem('bridgeSaved', JSON.stringify(savedProperties));
            showPropertyDetails(propertyId);
        }

        // Search properties
        function searchProperties(event) {
            const searchTerm = event.target.value.toLowerCase();
            const filtered = properties.filter(p => 
                (p.Area && p.Area.toLowerCase().includes(searchTerm)) ||
                (p.PropertyType && p.PropertyType.toLowerCase().includes(searchTerm)) ||
                (p.Title && p.Title.toLowerCase().includes(searchTerm))
            );
            renderProperties(filtered);
        }

        // Filter by area
        function filterByArea(area) {
            currentFilter = area;
            
            // Update active state
            document.querySelectorAll('.filter-pill').forEach(pill => {
                pill.classList.remove('active');
                if (pill.textContent === area) {
                    pill.classList.add('active');
                }
            });

            // Filter properties
            if (area === 'All') {
                renderProperties(properties);
            } else {
                const filtered = properties.filter(p => p.Area === area);
                renderProperties(filtered);
            }
        }

        // Calculate commission
        function calculateCommission(price, totalCommission, split) {
            const total = price * (totalCommission || 3) / 100;
            const [listing, selling] = (split || '50-50').split('-').map(Number);
            return total * selling / 100;
        }

        // Show saved properties
        function renderSavedProperties() {
            const saved = properties.filter(p => savedProperties.includes(p.id));
            const container = document.getElementById('savedList');
            
            if (saved.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">No saved properties yet</p>';
                return;
            }

            container.innerHTML = saved.map(property => {
                const imageUrl = property.Images && property.Images[0] 
                    ? property.Images[0].url 
                    : 'https://via.placeholder.com/400x200?text=No+Image';

                return `
                    <div class="property-card" onclick="showPropertyDetails('${property.id}')">
                        <img src="${imageUrl}" alt="Property" class="property-image">
                        <div class="property-content">
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">${property.Title || 'Untitled Property'}</h3>
                            <div class="property-price">KES ${formatPrice(property.Price || 0)}</div>
                            <div class="property-location">üìç ${property.Area}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show profile
        function showProfile() {
            document.getElementById('profileInfo').innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: var(--accent-gold); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 600;">
                        ${currentUser.name.charAt(0).toUpperCase()}
                    </div>
                    <p style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem;">${currentUser.name}</p>
                    <p style="color: var(--text-secondary);">${currentUser.email}</p>
                </div>
            `;
        }

        // Navigation
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            switch(page) {
                case 'login':
                    document.getElementById('loginPage').style.display = 'block';
                    break;
                case 'home':
                    document.getElementById('homePage').style.display = 'block';
                    document.querySelectorAll('.nav-item')[0].classList.add('active');
                    break;
                case 'developers':
                    document.getElementById('developersPage').style.display = 'block';
                    document.querySelectorAll('.nav-item')[1].classList.add('active');
                    break;
                case 'add':
                    document.getElementById('addPage').style.display = 'block';
                    document.querySelectorAll('.nav-item')[2].classList.add('active');
                    currentStep = 1;
                    updateStepDisplay();
                    break;
                case 'saved':
                    document.getElementById('savedPage').style.display = 'block';
                    document.querySelectorAll('.nav-item')[3].classList.add('active');
                    renderSavedProperties();
                    break;
                case 'profile':
                    document.getElementById('profilePage').style.display = 'block';
                    document.querySelectorAll('.nav-item')[4].classList.add('active');
                    showProfile();
                    break;
            }
        }

        // Utilities
        function formatPrice(price) {
            if (price >= 1000000) {
                return (price / 1000000).toFixed(1) + 'M';
            }
            return (price / 1000).toFixed(0) + 'K';
        }

        function closeModal() {
            document.getElementById('propertyModal').style.display = 'none';
        }

        function closeModalOnOutside(event) {
            if (event.target.classList.contains('modal')) {
                closeModal();
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
